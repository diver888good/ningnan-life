<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>å®å—ç”Ÿæ´» Â· é‡è¥é”€è½»èµ„äº§æœ€ç»ˆç‰ˆ</title>
<style>
*{box-sizing:border-box;margin:0;padding:0;font-family:PingFang SC,Microsoft YaHei,sans-serif}
body{background:#f5f7fa;color:#222;line-height:1.55}
.top-bar{background:#e63946;color:#fff;padding:5px 0;text-align:center;font-size:13px}
.header{background:linear-gradient(135deg,#e63946,#c01111);color:#fff;padding:28px 12px;text-align:center}
.banner{background:#ff6b00;color:#fff;padding:10px 0;text-align:center;font-weight:bold}
.nav{background:#b71c1c;display:flex;flex-wrap:wrap;justify-content:center;position:sticky;top:0;z-index:999}
.nav a{color:#fff;padding:12px 14px;text-decoration:none;font-size:15px}
.section{background:#fff;border-radius:12px;margin:12px;padding:18px;box-shadow:0 2px 10px rgba(0,0,0,0.05)}
.section h2{color:#e63946;border-left:6px solid #e63946;padding-left:12px;margin-bottom:14px}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:12px;margin-top:10px}
.card{border:1px solid #eee;border-radius:12px;padding:16px;transition:0.25s}
.card:hover{transform:translateY(-3px);box-shadow:0 6px 14px rgba(0,0,0,0.07)}
.btn{background:#e63946;color:#fff;border:none;border-radius:8px;padding:10px 16px;cursor:pointer;margin:6px;font-weight:bold}
.btn-orange{background:#ff6b00}
.btn-green{background:#00b46a}
.btn-blue{background:#1677ff}
.btn-gold{background:#ffc107;color:#222}
.btn-sm{padding:5px 9px;font-size:14px}
input,select{width:100%;padding:10px;margin:6px 0;border:1px solid #ddd;border-radius:8px}
.coupon{background:#fff5e6;border-left:6px solid #ff6b00;padding:12px;margin:8px 0;border-radius:8px}
.label{display:inline-block;padding:3px 6px;border-radius:4px;font-size:12px;color:#fff}
.label-orange{background:#ff6b00}
.label-green{background:#00b46a}
.label-blue{background:#1677ff}
.commission{color:#e63946;font-weight:bold}
.point{color:#1677ff;font-weight:bold}
.log-box{background:#f9f9f9;padding:10px;border-radius:8px;font-size:13px;max-height:220px;overflow-y:auto}
</style>
</head>
<body>

<div class="top-bar">ğŸ† è½»èµ„äº§è¿è¥ Â· å…¨è¥é”€è£‚å˜å¹³å°</div>
<div class="banner" id="topAd">ğŸ”¥ åˆ†äº«èµšé’± Â· æ¶ˆè´¹çœé’± Â· å•†å®¶è‡ªè¥ Â· å¹³å°åªåšè¥é”€</div>

<div class="header">
<h1>ğŸ§§ å®å—ç”Ÿæ´»è¥é”€å¹³å°</h1>
<p>äºŒçº§åˆ†é”€ Â· ä¼˜æƒ åˆ¸ Â· å¹¿å‘Šå˜ç° Â· é›¶åº“å­˜ Â· å…¨è£‚å˜</p>
</div>

<div class="nav">
<a href="#market">è¥é”€ä¸­å¿ƒ</a>
<a href="#shop">å•†å®¶å•†åŸ</a>
<a href="#order">æˆ‘çš„è®¢å•</a>
<a href="#user">æˆ‘çš„è´¦æˆ·</a>
<a href="#admin">ç®¡ç†åå°</a>
</div>

<div class="container">

<!-- è¥é”€ä¸­å¿ƒ -->
<div class="section" id="market">
<h2>ğŸ“£ è¥é”€ä¸­å¿ƒï¼ˆèµšé’±Â·çœé’±ï¼‰</h2>
<button class="btn-orange" onclick="goShare()">ğŸ‘‰ åˆ†äº«èµšé’±ï¼ˆäºŒçº§åˆ†é”€ï¼‰</button>
<button class="btn-green" onclick="goCoupon()">ğŸŸï¸ é¢†å–ä¼˜æƒ åˆ¸</button>
<button class="btn-gold" onclick="goVip()">ğŸ‘‘ ä¼šå‘˜ç­‰çº§</button>
<button class="btn-blue" onclick="goPoint()">ğŸ’° ç§¯åˆ†ä¸­å¿ƒ</button>
<div id="marketPanel"></div>
</div>

<!-- å•†å®¶å•†åŸ -->
<div class="section" id="shop">
<h2>ğŸª å•†å®¶è‡ªè¥å•†åŸï¼ˆé›¶åº“å­˜ï¼‰</h2>
<input placeholder="æœç´¢å•†å“" id="kw" oninput="searchGoods()">
<div id="cateList"></div>
<div>
<label><input type="radio" name="deliver" value="all" checked onclick="loadShop()"> å…¨éƒ¨</label>
<label><input type="radio" name="deliver" value="è‡ªæ" onclick="loadShop()"> ğŸšš è‡ªæä¼˜å…ˆ</label>
</div>
<button class="btn-red" onclick="toTopAd()">ğŸ”¥ å•†å“ç½®é¡¶ï¼ˆè¥é”€å¹¿å‘Šï¼‰</button>
<div class="grid" id="shopList"></div>
<button class="btn-green" onclick="addGoods()">å•†å®¶å‘å¸ƒå•†å“</button>
</div>

<!-- è®¢å• -->
<div class="section" id="order">
<h2>ğŸ§¾ æˆ‘çš„è®¢å•</h2>
<button class="btn" onclick="loadOrder()">åˆ·æ–°è®¢å•</button>
<button class="btn-blue" onclick="toVerify()">âœ… åˆ°åº—æ ¸é”€</button>
<button class="btn-orange" onclick="toRefund()">ç”³è¯·é€€æ¬¾</button>
<div id="orderList"></div>
</div>

<!-- æˆ‘çš„è´¦æˆ· -->
<div class="section" id="user">
<h2>ğŸ‘¤ æˆ‘çš„è´¦æˆ·ï¼ˆåˆ†é”€+ä½£é‡‘ï¼‰</h2>
<div id="loginBox"></div>
<div id="userInfo"></div>
<button class="btn-gold" onclick="myCommission()">ğŸ’° æˆ‘çš„ä½£é‡‘</button>
<button class="btn-orange" onclick="toWithdraw()">æç°</button>
<button class="btn-green" onclick="myTeam()">ğŸ‘¥ æˆ‘çš„å›¢é˜Ÿï¼ˆäºŒçº§ï¼‰</button>
<div id="userPanel"></div>
</div>

<!-- ç®¡ç†åå° -->
<div class="section" id="admin">
<h2>âš™ï¸ å¹³å°ç®¡ç†ï¼ˆé‡è¥é”€Â·è½»èµ„äº§ï¼‰</h2>
<button class="btn-orange" onclick="checkAd()">å¹¿å‘Šå®¡æ ¸</button>
<button class="btn-blue" onclick="checkWithdraw()">æç°å®¡æ ¸</button>
<button class="btn-green" onclick="checkRefund()">é€€æ¬¾å®¡æ ¸</button>
<button class="btn" onclick="setCoupon()">è®¾ç½®ä¼˜æƒ åˆ¸ï¼ˆè¥é”€ï¼‰</button>
<div id="adminPanel"></div>
</div>

</div>

<script>
// æœ¬åœ°å­˜å‚¨
function get(k){return JSON.parse(localStorage.getItem(k)||"[]")}
function set(k,v){localStorage.setItem(k,JSON.stringify(v))}

// å¹³å°é…ç½®
const CONFIG = {
  commission1: 0.10,
  commission2: 0.05,
  topPrice: 10,
  bannerPrice: 30,
  freezeCommission: true
};

// å…¨å±€æ•°æ®
let users = get("users") || [
  {id:1,mobile:"admin",pwd:"admin",role:"admin",balance:0,commission:0,commissionLock:0,point:0,invite:"ADMIN",p1:[],p2:[]},
  {id:2,mobile:"13800138000",pwd:"123456",role:"shop",balance:0,commission:0,commissionLock:0,point:0,invite:"SHOP01",p1:[],p2:[]}
];
let currentUser = get("currentUser");
let goods = get("goods") || [];
let orders = get("orders") || [];
let ads = get("ads") || [];
let withdraws = get("withdraws") || [];
let refunds = get("refunds") || [];
let coupons = get("coupons") || [
  {name:"æ–°äººæ»¡30å‡3",val:3,limit:30,type:"æ–°äºº"},
  {name:"æ»¡50å‡5",val:5,limit:50,type:"é€šç”¨"},
  {name:"æ»¡100å‡15",val:15,limit:100,type:"é€šç”¨"}
];
let commissionLog = get("commissionLog") || [];
let cates = ["ç¾é£Ÿ","ç”Ÿé²œ","æœé¥°","æ—¥ç”¨","æœåŠ¡"];

// ç™»å½•
function showLogin(){
  if(currentUser){
    loginBox.innerHTML = `
      å·²ç™»å½•ï¼š${currentUser.mobile}ï½œ${currentUser.role}
      <button onclick="logout()">é€€å‡º</button>`;
    userInfo.innerHTML = `
      ä½™é¢ï¼š${currentUser.balance.toFixed(2)}ï½œ
      ä½£é‡‘ï¼š<span class="commission">${currentUser.commission.toFixed(2)}</span>ï½œ
      å†»ç»“ä½£é‡‘ï¼š${currentUser.commissionLock.toFixed(2)}ï½œ
      ç§¯åˆ†ï¼š<span class="point">${currentUser.point}</span>`;
  }else{
    loginBox.innerHTML = `
      <input placeholder="æ‰‹æœºå·" id="mobile" value="13800138000">
      <input placeholder="å¯†ç " id="pwd" value="123456" type="password">
      <button class="btn" onclick="login()">ç™»å½•</button>
      <button class="btn-green" onclick="register()">æ³¨å†Œ</button>`;
  }
}

function login(){
  let m = mobile.value, p = pwd.value;
  currentUser = users.find(u=>u.mobile==m&&u.pwd==p);
  if(!currentUser){alert("è´¦å·æˆ–å¯†ç é”™è¯¯");return;}
  set("currentUser",currentUser);
  showLogin();
  loadAll();
}
function logout(){currentUser=null;set("currentUser",null);showLogin();}
function register(){
  let m=prompt("è¯·è¾“å…¥æ‰‹æœºå·"),p=prompt("è¯·è¾“å…¥å¯†ç ");
  if(!m||!p||users.find(x=>x.mobile==m)){alert("æ³¨å†Œå¤±è´¥");return;}
  let newUser = {
    id:users.length+1,mobile:m,pwd:p,role:"shop",
    balance:0,commission:0,commissionLock:0,point:0,
    invite:"U"+(users.length+1),p1:[],p2:[]
  };
  users.push(newUser);
  set("users",users);
  alert("æ³¨å†ŒæˆåŠŸï¼å·²èµ é€æ–°äººåˆ¸");
}

// åˆ†é”€
function goShare(){
  if(!currentUser)return;
  marketPanel.innerHTML = `
  <div class="card">
    <h3>åˆ†äº«èµšé’±</h3>
    <p>ä½ çš„é‚€è¯·ç ï¼š<b>${currentUser.invite}</b></p>
    <p>ä¸€çº§ä½£é‡‘ï¼š10%ï½œäºŒçº§ä½£é‡‘ï¼š5%</p>
    <p>ä½£é‡‘å†»ç»“ï¼šæ ¸é”€åè‡ªåŠ¨åˆ°è´¦</p>
    <button class="btn-orange" onclick="bindInvite()">ç»‘å®šé‚€è¯·ç </button>
    <button class="btn-blue" onclick="showCommissionLog()">ä½£é‡‘æ˜ç»†</button>
  </div>`;
}
function bindInvite(){
  let code=prompt("è¯·è¾“å…¥é‚€è¯·ç ");
  let u=users.find(x=>x.invite==code);
  if(!u){alert("é‚€è¯·ç æ— æ•ˆ");return;}
  u.p1.push(currentUser.mobile);
  set("users",users);
  alert("ç»‘å®šä¸Šçº§æˆåŠŸï¼");
}
function myTeam(){
  if(!currentUser)return;
  alert(`ä¸€çº§æˆå‘˜ï¼š${currentUser.p1.length}äºº\näºŒçº§æˆå‘˜ï¼š${currentUser.p2.length}äºº`);
}
function showCommissionLog(){
  let html = commissionLog.filter(x=>x.to==currentUser.mobile).map(x=>`
    <div>${x.time}ï½œ${x.desc}ï½œ+${x.money.toFixed(2)}å…ƒ</div>
  `).join("")||"æš‚æ— è®°å½•";
  marketPanel.innerHTML = `<div class="log-box">${html}</div>`;
}

// åˆ†ä½£ + å†»ç»“
function giveCommission(money,orderNo){
  if(!currentUser) return;
  let u1 = users.find(x=>x.p1.includes(currentUser.mobile));
  if(u1){
    let c1 = money * CONFIG.commission1;
    if(CONFIG.freezeCommission){ u1.commissionLock += c1; }else{ u1.commission += c1; }
    commissionLog.push({to:u1.mobile,orderNo,desc:"ä¸€çº§ä½£é‡‘",money:c1,time:new Date().toLocaleString()});
    let u2 = users.find(x=>x.p1.includes(u1.mobile));
    if(u2){
      let c2 = money * CONFIG.commission2;
      if(CONFIG.freezeCommission){ u2.commissionLock += c2; }else{ u2.commission += c2; }
      commissionLog.push({to:u2.mobile,orderNo,desc:"äºŒçº§ä½£é‡‘",money:c2,time:new Date().toLocaleString()});
    }
    set("users",users);
    set("commissionLog",commissionLog);
  }
}

// æ ¸é”€è§£å†»ä½£é‡‘
function unlockCommission(orderNo){
  let log = commissionLog.filter(x=>x.orderNo==orderNo);
  log.forEach(l=>{
    let u = users.find(x=>x.mobile==l.to);
    if(u){ u.commissionLock -= l.money; u.commission += l.money; }
  });
  set("users",users);
}

// ä¼˜æƒ åˆ¸
function goCoupon(){
  marketPanel.innerHTML = coupons.map(c=>`
    <div class="coupon">
      <strong>${c.name}</strong><br>
      æ»¡${c.limit}å‡${c.val}ï½œ${c.type}
      <button class="btn-green btn-sm" onclick="useCoupon('${c.name}')">ç«‹å³ä½¿ç”¨</button>
    </div>
  `).join("");
}
function useCoupon(name){alert(`å·²ä½¿ç”¨ä¼˜æƒ åˆ¸ï¼š${name}`);}

// ç§¯åˆ†
function goPoint(){
  marketPanel.innerHTML=`<div class="card">
    å½“å‰ç§¯åˆ†ï¼š${currentUser?.point||0}<br>
    è§„åˆ™ï¼šæ¶ˆè´¹1å…ƒ=1ç§¯åˆ†ï¼Œå¯æŠµç°/å‡çº§
  </div>`;
}
function addPoint(money){
  if(!currentUser)return;
  currentUser.point += Math.floor(money);
  set("users",users);
  showLogin();
}

// å¹¿å‘Š
function toTopAd(){
  if(!currentUser){alert("è¯·ç™»å½•");return;}
  alert(`æ”¯ä»˜${CONFIG.topPrice}å…ƒï¼Œå•†å“ç½®é¡¶å±•ç¤ºï¼Œæµé‡ç¿»å€ï¼`);
}

// æ ¸é”€
function toVerify(){
  let no=prompt("è¾“å…¥è®¢å•å·");
  let o=orders.find(x=>x.orderNo==no&&x.status=="paid");
  if(!o){alert("æ ¸é”€å¤±è´¥ï¼šè®¢å•ä¸å­˜åœ¨æˆ–æœªæ”¯ä»˜");return;}
  o.status="used";
  unlockCommission(no);
  set("orders",orders);
  alert("æ ¸é”€æˆåŠŸï¼ä½£é‡‘å·²è‡ªåŠ¨è§£å†»");
  loadOrder();
}

// é€€æ¬¾
function toRefund(){
  let no=prompt("è¯·è¾“å…¥è¦é€€æ¬¾çš„è®¢å•å·");
  if(!no)return;
  refunds.push({
    orderNo:no,mobile:currentUser.mobile,status:"å¾…å®¡æ ¸",time:new Date().toLocaleString()
  });
  set("refunds",refunds);
  alert("é€€æ¬¾ç”³è¯·å·²æäº¤ï¼Œå¹³å°å®¡æ ¸åç”±å•†å®¶æ‰¿æ‹…");
}
function checkRefund(){
  if(currentUser?.role!="admin")return;
  adminPanel.innerHTML=refunds.map(r=>`
    <div class="card">
      ${r.orderNo}ï½œ${r.mobile}ï½œ${r.status}
      <button onclick="refundPass('${r.orderNo}')">åŒæ„é€€æ¬¾</button>
    </div>
  `).join("")||"æš‚æ— é€€æ¬¾";
}
function refundPass(no){
  let o=orders.find(x=>x.orderNo==no);
  if(o)o.status="refund";
  let r=refunds.find(x=>x.orderNo==no);
  if(r)r.status="å·²åŒæ„";
  set("orders",orders);set("refunds",refunds);
  checkRefund();
}

// å•†åŸ
function searchGoods(){loadShop();}
function loadShop(){
  let kw=document.getElementById("kw")?.value||"";
  let d=document.querySelector('input[name="deliver"]:checked')?.value||"all";
  let list=goods.filter(g=>g.name.includes(kw)&&(d=="all"||g.deliver==d));
  shopList.innerHTML=list.map(g=>`
    <div class="card">
      <h3>${g.name}</h3>
      <p>ï¿¥${g.price}</p>
      <p><span class="label label-green">å•†å®¶è‡ªè¥</span> ${g.deliver}</p>
      <button class="btn-orange" onclick="buy(${g.id})">ç«‹å³è´­ä¹°</button>
    </div>
  `).join("")||"æš‚æ— å•†å“";
}
function buy(id){
  if(!currentUser){alert("è¯·ç™»å½•");return;}
  let g=goods.find(x=>x.id==id);
  let orderNo="O"+Date.now();
  orders.unshift({
    orderNo,goods:g.name,price:g.price,
    mobile:currentUser.mobile,status:"paid",time:new Date().toLocaleString()
  });
  set("orders",orders);
  giveCommission(g.price,orderNo);
  addPoint(g.price);
  alert("ä¸‹å•æˆåŠŸï¼è¯·åˆ°åº—æ ¸é”€");
  loadOrder();
}

// è®¢å•
function loadOrder(){
  orderList.innerHTML=orders.filter(o=>o.mobile==currentUser?.mobile).map(o=>`
    <div class="card">
      ${o.orderNo}<br>
      ${o.goods} ï¿¥${o.price}
      <span class="label ${o.status=='paid'?'label-orange':o.status=='used'?'label-green':o.status=='refund'?'label-red':''}">
        ${o.status=='paid'?'å·²æ”¯ä»˜':o.status=='used'?'å·²æ ¸é”€':'å·²é€€æ¬¾'}
      </span>
    </div>
  `).join("")||"æš‚æ— è®¢å•";
}

// ä¼šå‘˜
function goVip(){
  let total=orders.filter(o=>o.mobile==currentUser?.mobile&&o.status=="used")
    .reduce((s,i)=>s+Number(i.price),0);
  let lv=total>=2000?"é’»çŸ³ä¼šå‘˜":total>=500?"é‡‘å¡ä¼šå‘˜":total>=100?"é“¶å¡ä¼šå‘˜":"æ™®é€šä¼šå‘˜";
  marketPanel.innerHTML=`<div class="card">
    å½“å‰ç­‰çº§ï¼š${lv}<br>
    ç´¯è®¡æ¶ˆè´¹ï¼š${total.toFixed(2)}å…ƒ
  </div>`;
}

// ä½£é‡‘ & æç°
function myCommission(){
  if(!currentUser)return;
  alert(`å¯æç°ä½£é‡‘ï¼š${currentUser.commission.toFixed(2)}å…ƒ`);
}
function toWithdraw(){alert("è¯·è”ç³»å¹³å°å®¢æœè¿›è¡Œæç°");}
function checkWithdraw(){if(currentUser?.role!="admin")return;adminPanel.innerHTML="åŠŸèƒ½å·²é¢„ç•™";}
function checkAd(){if(currentUser?.role!="admin")return;adminPanel.innerHTML="åŠŸèƒ½å·²é¢„ç•™";}
function setCoupon(){if(currentUser?.role!="admin")return;adminPanel.innerHTML="åŠŸèƒ½å·²é¢„ç•™";}

// å‘å¸ƒå•†å“
function addGoods(){
  if(!currentUser||currentUser.role!="shop"){alert("å•†å®¶æ‰å¯å‘å¸ƒ");return;}
  let name=prompt("å•†å“å"),price=prompt("ä»·æ ¼");
  if(!name||!price)return;
  goods.push({id:goods.length+1,name,price,deliver:"è‡ªæ",shop:currentUser.mobile,top:false});
  set("goods",goods);loadShop();
}

// å¯åŠ¨
function loadAll(){showLogin();loadShop();loadOrder();}
loadAll();
</script>
</body>
</html>
